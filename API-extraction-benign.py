import os

apkPath = "D:/5/"

apklist = os.listdir(apkPath)


outputPath = "D:/5/"


for i in range(len(apklist)): 
    APIname="API-{0}.txt".format(apklist[i])
    sourcepath = apkPath+apklist[i] + "/" + "smali"
    APIpath = outputPath+apklist[i] + "/" + APIname
    print(APIpath)

    rule = ".smali"
    list = []
    for fpathe, dirs, fs in os.walk(sourcepath):  # Get all directories
        for f in fs:
            filename = os.path.join(fpathe, f)
            if filename.endswith(rule):
                list.append(filename)
    l = len(list)

    for p in range(l):

        f1 = open(list[p], "r", encoding='UTF-8')

        for line in f1.readlines():  # Read each row in turn
            line = line.strip()

            if "invoke" in line:
                line = line.split(" ")
                if line[-1].startswith("Landroid"):
                    f3 = open(APIpath, "a", encoding='UTF-8')
                    f3.write(line[-1] + "\n")
                    f3.close()

print("Complete!")
