#Extract opcode features from smail files

import os

apkPath = "D:/5/"

folderlist1 = os.listdir(apkPath)


for i in range(len(folderlist1)):  
    filelist1 = apkPath + folderlist1[i]
    folderlist2=os.listdir(filelist1)
    for j in range(len(folderlist2)):
        filelist2=filelist1 +"/"+ folderlist2[j]
        folderlist3=os.listdir(filelist2)
        for k in range(len(folderlist3)):
            filelist3 = filelist2 + "/"+folderlist3[k]
            folderlist4 = os.listdir(filelist3)
            for l in range(len(folderlist4)):
                filelist4=filelist3 + "/"+folderlist4[l]
                folderlist5=os.listdir(filelist4)
                festlist = os.listdir(filelist4)
                APIname ="opcode-{0}-{1}-{2}-{3}.txt".format(i,j,k,l)

                sourcepath=filelist4 + "/" +"smali"
                APIpath=filelist4 + "/" + APIname

                rule = ".smali"
                list = []
                for fpathe, dirs, fs in os.walk(sourcepath):  
                    for f in fs:
                        filename = os.path.join(fpathe, f)
                        if filename.endswith(rule):
                            list.append(filename)
                l=len(list)

                for p in range(l):

                    f1 = open(list[p], "r",encoding='UTF-8')

                    for line in f1.readlines():  
                        line = line.strip()
                        line = line.split(" ")

                        if line[0].startswith("move"):
                                f3 = open(APIpath, "a",encoding='UTF-8')
                                f3.write("M" + "/")
                                f3.close()
                        if line[0].startswith("return"):
                                f3 = open(APIpath, "a",encoding='UTF-8')
                                f3.write("R" + "/")
                                f3.close()
                        if line[0].startswith("if"):
                                f3 = open(APIpath, "a",encoding='UTF-8')
                                f3.write("I" + "/")
                                f3.close()
                        if line[0].startswith("aput"):
                                f3 = open(APIpath, "a",encoding='UTF-8')
                                f3.write("P" + "/")
                                f3.close()
                        if line[0].startswith("iput"):
                            f3 = open(APIpath, "a", encoding='UTF-8')
                            f3.write("P" + "/")
                            f3.close()
                        if line[0].startswith("sput"):
                            f3 = open(APIpath, "a", encoding='UTF-8')
                            f3.write("P" + "/")
                            f3.close()
                        if line[0].startswith("aget"):
                            f3 = open(APIpath, "a", encoding='UTF-8')
                            f3.write("T" + "/")
                            f3.close()
                        if line[0].startswith("iget"):
                            f3 = open(APIpath, "a", encoding='UTF-8')
                            f3.write("T" + "/")
                            f3.close()
                        if line[0].startswith("sget"):
                            f3 = open(APIpath, "a", encoding='UTF-8')
                            f3.write("T" + "/")
                            f3.close()
                        if line[0].startswith("invoke"):
                            f3 = open(APIpath, "a", encoding='UTF-8')
                            f3.write("V" + "/")
                            f3.close()
                        if line[0].startswith("goto"):
                            f3 = open(APIpath, "a", encoding='UTF-8')
                            f3.write("G" + "/")
                            f3.close()
                        if line[0].startswith(".end"):
                            f3 = open(APIpath, "a", encoding='UTF-8')
                            f3.write("\n")
                            f3.close()



print("Complete!")

