#Extracting Opcode sequences from benign software

import os

apkPath = "D:/5/"

apklist = os.listdir(apkPath)


outputPath = "D:/5/"


for i in range(len(apklist)):  
    APIname="opcode-{0}.txt".format(apklist[i])
    sourcepath = apkPath+apklist[i] + "/" + "smali"
    APIpath = apkPath+apklist[i] + "/" + APIname
    print(APIpath)

    rule = ".smali"
    list = []
    for fpathe, dirs, fs in os.walk(sourcepath):  
        for f in fs:
            filename = os.path.join(fpathe, f)
            if filename.endswith(rule):
                list.append(filename)
    l = len(list)

    for p in range(l):

        f1 = open(list[p], "r", encoding='UTF-8')

        for line in f1.readlines(): 
            line = line.strip()
            line = line.split(" ")

            if line[0].startswith("move"):
                f3 = open(APIpath, "a", encoding='UTF-8')
                f3.write("M" + "/")
                f3.close()
            if line[0].startswith("return"):
                f3 = open(APIpath, "a", encoding='UTF-8')
                f3.write("R" + "/")
                f3.close()
            if line[0].startswith("if"):
                f3 = open(APIpath, "a", encoding='UTF-8')
                f3.write("I" + "/")
                f3.close()
            if line[0].startswith("aput"):
                f3 = open(APIpath, "a", encoding='UTF-8')
                f3.write("P" + "/")
                f3.close()
            if line[0].startswith("iput"):
                f3 = open(APIpath, "a", encoding='UTF-8')
                f3.write("P" + "/")
                f3.close()
            if line[0].startswith("sput"):
                f3 = open(APIpath, "a", encoding='UTF-8')
                f3.write("P" + "/")
                f3.close()
            if line[0].startswith("aget"):
                f3 = open(APIpath, "a", encoding='UTF-8')
                f3.write("T" + "/")
                f3.close()
            if line[0].startswith("iget"):
                f3 = open(APIpath, "a", encoding='UTF-8')
                f3.write("T" + "/")
                f3.close()
            if line[0].startswith("sget"):
                f3 = open(APIpath, "a", encoding='UTF-8')
                f3.write("T" + "/")
                f3.close()
            if line[0].startswith("invoke"):
                f3 = open(APIpath, "a", encoding='UTF-8')
                f3.write("V" + "/")
                f3.close()
            if line[0].startswith("goto"):
                f3 = open(APIpath, "a", encoding='UTF-8')
                f3.write("G" + "/")
                f3.close()
            if line[0].startswith(".end"):
                f3 = open(APIpath, "a", encoding='UTF-8')
                f3.write("\n")
                f3.close()

print("Complete!")
