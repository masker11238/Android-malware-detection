import os

apkPath = "D:/apk/"

folderlist1 = os.listdir(apkPath)


for i in range(len(folderlist1)):  
    filelist1 = apkPath + folderlist1[i]
    folderlist2=os.listdir(filelist1)
    for j in range(len(folderlist2)):
        filelist2=filelist1 +"/"+ folderlist2[j]
        folderlist3=os.listdir(filelist2)
        for k in range(len(folderlist3)):
            filelist3 = filelist2 + "/"+folderlist3[k]
            folderlist4 = os.listdir(filelist3)
            for l in range(len(folderlist4)):
                filelist4=filelist3 + "/"+folderlist4[l]
                folderlist5=os.listdir(filelist4)
                festlist = os.listdir(filelist4)
                APIname ="API-{0}-{1}-{2}-{3}.txt".format(i,j,k,l)

                sourcepath=filelist4 + "/" +"smali"
                APIpath=filelist4 + "/" + APIname

                rule = ".smali"
                list = []
                for fpathe, dirs, fs in os.walk(sourcepath):  # # Get all directories
                    for f in fs:
                        filename = os.path.join(fpathe, f)
                        if filename.endswith(rule):
                            list.append(filename)
                l=len(list)

                for p in range(l):

                    f1 = open(list[p], "r",encoding='UTF-8')

                    for line in f1.readlines():  # Read each row in turn
                        line = line.strip()


                        if "invoke" in line:
                            line=line.split(" ")
                            if line[-1].startswith("Landroid"):
                                f3 = open(APIpath, "a",encoding='UTF-8')
                                f3.write(line[-1] + "\n")
                                f3.close()

print("Complete!")

